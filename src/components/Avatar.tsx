import clsx from "clsx";
import { useMemo } from "react";

const SIZES: Record<supportedSizes, { width: number; height: number }> = {
  md: {
    width: 28,
    height: 28,
  },
  lg: {
    width: 40,
    height: 40,
  },
};

type supportedSizes = "md" | "lg";

const DEFAULT_INPUT = "near";
export default function Avatar({
  className,
  size = "md",
  inputString = DEFAULT_INPUT,
}: {
  className?: string;
  size?: supportedSizes;
  inputString: string;
}) {
  const currentSize = SIZES[size];
  const { bgInner, bgOuter, form } = useMemo(
    () => calculateAvatarStyles(inputString),
    [inputString]
  );
  return (
    <div
      className={clsx(
        "relative flex-shrink-0 overflow-hidden rounded-full bg-violet-5",
        className
      )}
      style={{
        width: currentSize.width,
        height: currentSize.height,
      }}
      aria-hidden="true"
    >
      <div
        className={clsx("absolute rounded-full bg-[#63E3A4]")}
        style={{
          background: bgOuter,
        }}
      >
        <svg
          width={currentSize.width}
          height={currentSize.height}
          viewBox="0 0 40 41"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          {(() => {
            switch (form) {
              case 0:
                return (
                  <>
                    <path
                      d="M42.7269 37.2468C44.5716 24.121 35.4265 11.9849 22.3006 10.1402C9.17477 8.29549 -2.96126 17.4406 -4.80598 30.5665C-6.65069 43.6923 2.49446 55.8284 15.6203 57.6731C28.7461 59.5178 40.8822 50.3726 42.7269 37.2468Z"
                      fill={bgInner}
                    />
                    <path
                      d="M14.0352 27.4722C13.8814 28.5665 14.3135 29.6974 15.2365 30.6162C16.1594 31.535 17.4977 32.1664 18.9568 32.3715C20.4158 32.5765 21.8763 32.3385 23.0167 31.7097C24.1572 31.0809 24.8843 30.1129 25.0381 29.0185"
                      fill="black"
                    />
                    <path
                      d="M14.4128 20.7931C14.4982 20.1854 14.198 19.6408 13.7422 19.5768C13.2865 19.5127 12.8478 19.9534 12.7624 20.5611C12.677 21.1688 12.9772 21.7133 13.4329 21.7774C13.8887 21.8414 14.3274 21.4007 14.4128 20.7931Z"
                      fill="black"
                    />
                    <path
                      d="M27.6159 22.6487C27.7013 22.041 27.4011 21.4964 26.9453 21.4324C26.4896 21.3683 26.0509 21.809 25.9655 22.4167C25.8801 23.0244 26.1803 23.5689 26.6361 23.633C27.0918 23.697 27.5305 23.2563 27.6159 22.6487Z"
                      fill="black"
                    />
                  </>
                );

              case 1:
                return (
                  <>
                    <path
                      d="M7.35897 13.784C-0.0320463 21.9925 0.630699 34.6385 8.83925 42.0295C17.0478 49.4205 29.6937 48.7578 37.0848 40.5492C44.4758 32.3407 43.813 19.6947 35.6045 12.3037C27.3959 4.9127 14.75 5.57544 7.35897 13.784Z"
                      fill={bgInner}
                    />
                    <path
                      d="M7.82031 22.9154C7.85888 24.0198 8.48082 25.0585 9.54933 25.8031C10.6178 26.5477 12.0454 26.9371 13.5179 26.8856C14.9904 26.8342 16.3873 26.3462 17.4013 25.5289C18.4152 24.7116 18.9632 23.632 18.9247 22.5276"
                      fill="black"
                    />
                    <path
                      d="M8.22005 18.4542C8.19864 17.841 7.80841 17.3568 7.34845 17.3729C6.88849 17.389 6.53299 17.8991 6.5544 18.5124C6.57582 19.1257 6.96605 19.6098 7.426 19.5938C7.88596 19.5777 8.24147 19.0675 8.22005 18.4542Z"
                      fill="black"
                    />
                    <path
                      d="M19.3245 18.0664C19.3031 17.4532 18.9129 16.969 18.4529 16.9851C17.993 17.0011 17.6375 17.5113 17.6589 18.1246C17.6803 18.7379 18.0705 19.222 18.5305 19.2059C18.9905 19.1899 19.346 18.6797 19.3245 18.0664Z"
                      fill="black"
                    />{" "}
                  </>
                );

              case 2:
                return (
                  <>
                    {" "}
                    <path
                      d="M39.7948 38.011C44.9297 26.9991 40.1655 13.9096 29.1536 8.77465C18.1417 3.63973 5.05217 8.40394 -0.0827582 19.4158C-5.21768 30.4277 -0.453467 43.5173 10.5584 48.6522C21.5703 53.7871 34.6599 49.0229 39.7948 38.011Z"
                      fill={bgInner}
                    />
                    <path
                      d="M13.1611 25.563C13.0648 26.6639 13.5555 27.7706 14.5253 28.6399C15.4951 29.5091 16.8646 30.0696 18.3324 30.198C19.8002 30.3264 21.2462 30.0123 22.3522 29.3246C23.4582 28.637 24.1337 27.6322 24.23 26.5314"
                      fill="black"
                    />
                    <path
                      d="M16.4121 20.2706C16.4656 19.6593 16.1373 19.1312 15.6788 19.0911C15.2203 19.051 14.8053 19.514 14.7518 20.1253C14.6983 20.7366 15.0266 21.2647 15.4851 21.3048C15.9436 21.3449 16.3586 20.8819 16.4121 20.2706Z"
                      fill="black"
                    />
                    <path
                      d="M23.0537 20.8516C23.1072 20.2403 22.7789 19.7122 22.3204 19.6721C21.8619 19.632 21.4469 20.0951 21.3934 20.7064C21.3399 21.3177 21.6682 21.8458 22.1267 21.8859C22.5852 21.926 23.0002 21.4629 23.0537 20.8516Z"
                      fill="black"
                    />
                  </>
                );
              case 3:
                return (
                  <>
                    <path
                      d="M10.0997 11.3677L8.05354 40.6296C7.77102 44.6698 10.8172 48.1741 14.8575 48.4566L44.1193 50.5028C48.1596 50.7853 51.6638 47.7391 51.9464 43.6989L53.9925 14.437C54.2751 10.3968 51.2288 6.89251 47.1886 6.60999L17.9267 4.5638C13.8865 4.28128 10.3822 7.3275 10.0997 11.3677Z"
                      fill={bgInner}
                    />
                    <path
                      d="M19.0576 27.5488C19.1347 28.6512 19.7925 29.6676 20.8864 30.3744C21.9802 31.0812 23.4205 31.4206 24.8903 31.3178C26.3601 31.215 27.7391 30.6785 28.724 29.8264C29.7088 28.9742 30.2188 27.8761 30.1417 26.7738"
                      fill="black"
                    />
                    <path
                      d="M17.0077 22.123C16.9649 21.5108 16.558 21.0406 16.0989 21.0727C15.6398 21.1048 15.3023 21.6271 15.3451 22.2393C15.3879 22.8514 15.7948 23.3216 16.2539 23.2895C16.713 23.2574 17.0505 22.7352 17.0077 22.123Z"
                      fill="black"
                    />
                    <path
                      d="M32.5253 21.0379C32.4825 20.4258 32.0756 19.9555 31.6165 19.9876C31.1573 20.0198 30.8199 20.542 30.8627 21.1542C30.9055 21.7663 31.3124 22.2366 31.7715 22.2045C32.2306 22.1724 32.5681 21.6501 32.5253 21.0379Z"
                      fill="black"
                    />
                  </>
                );
              case 4:
                return (
                  <>
                    <path
                      d="M45.2229 5.82021L13.3008 8.05242C8.89331 8.36063 5.57016 12.1835 5.87836 16.591L8.11057 48.513C8.41878 52.9206 12.2416 56.2437 16.6491 55.9355L48.5712 53.7033C52.9787 53.3951 56.3019 49.5722 55.9937 45.1647L53.7614 13.2427C53.4532 8.83516 49.6304 5.51201 45.2229 5.82021Z"
                      fill={bgInner}
                    />
                    <path
                      d="M18.5703 24.3456C18.4548 25.4446 18.9261 26.5598 19.8806 27.4458C20.8351 28.3318 22.1945 28.9161 23.6599 29.0701C25.1252 29.2242 26.5765 28.9353 27.6943 28.2671C28.8122 27.5988 29.505 26.606 29.6206 25.507"
                      fill="black"
                    />
                    <path
                      d="M20.9252 17.8896C20.9893 17.2793 20.6703 16.7456 20.2126 16.6975C19.7548 16.6494 19.3318 17.1051 19.2676 17.7154C19.2035 18.3257 19.5226 18.8594 19.9803 18.9075C20.438 18.9556 20.861 18.4999 20.9252 17.8896Z"
                      fill="black"
                    />
                    <path
                      d="M29.765 18.8188C29.8292 18.2085 29.5101 17.6748 29.0524 17.6267C28.5947 17.5785 28.1716 18.0343 28.1075 18.6446C28.0433 19.2549 28.3624 19.7886 28.8201 19.8367C29.2778 19.8848 29.7009 19.4291 29.765 18.8188Z"
                      fill="black"
                    />
                  </>
                );

              default:
                return null;
            }
          })()}
        </svg>
      </div>
    </div>
  );
}

const colors = [
  "#B7B2F0",
  "#FE8371",
  "#63E3A4",
  "#FFD386",
  "#3BCECA",
  "#A6FCD2",
  "#ADF5F3",
  "#FFE0DB",
  "#B7B2F0",
];
const forms = [0, 1, 2, 3, 4];

const paramsHash: Record<string, AvatarParams> = {};
type AvatarParams = {
  bgInner: string;
  bgOuter: string;
  form: number;
};

const calculateAvatarStyles = (str: string): AvatarParams => {
  try {
    const cashed = paramsHash[str];
    if (cashed) return cashed;
    if (str.length < 2) str += DEFAULT_INPUT;
    const bgInner = str.charCodeAt(0) % forms.length;
    const form = str.charCodeAt(1) % forms.length;
    const bgOuter = bgInner >= colors.length ? 0 : bgInner + 1;
    const result = {
      bgInner: colors[bgInner],
      form: forms[form],
      bgOuter: colors[bgOuter],
    };
    paramsHash[str] = result;
    return result;
  } catch {
    return {
      bgInner: "#63E3A4",
      form: 0,
      bgOuter: "#B7B2F0",
    };
  }
};

/**
 * @description remove 0x from the eth like wallet 0xB1176e20C4368fA25616586D9469Dd02F2772c12
 */
export const ethWalletAvatarInputFormatter = (address: string): string => {
  try {
    if (address.includes("0x")) return address.slice(2);
    return address;
  } catch {
    return address;
  }
};
